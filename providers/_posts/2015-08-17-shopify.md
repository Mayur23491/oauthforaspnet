---
layout: provider
title: Shopify
logo: shopify.png
links:
  - name: Shopify Home
    url: http://www.shopify.com/
  - name: Shopify App Store
    url: https://apps.shopify.com/
  - name: Shopfiy API Doc
    url: https://docs.shopify.com/api
  - name: Shopify OAuth Specification
    url: https://docs.shopify.com/api/authentication/oauth
  - name: Shopify Partner Site
    url: https://www.shopify.com/app-developers
---
## 1. Register an app in Shopify Partner - Developer Account

Go to - "Shopify Partner Site" to create account and in the left hand navigation select Apps. Under Apps, click the top right button labeled "Create app" and go through the steps to create new app. After you have created the application, take note of the API key and Credential sets (API secret).

![](/images/shopify-api-key-and-secret.png)

## 2. Install the Nuget Package

Install the Nuget Package which contains the Shopify OAuth provider.

{% highlight bash %}
Install-Package Owin.Security.Providers
{% endhighlight %}

## 3. Register Provider

Locate the file in your project called `\App_Start\Startup.Auth.cs`. Ensure that you have imported the `Owin.Security.Providers.Shopify` namespace:

{% highlight csharp %}
using Owin.Security.Providers.Shopify;
{% endhighlight %}

In the `ConfigureAuth` method add the following lines of code:

{% highlight csharp %}
app.UseShopifyAuthentication(
    apiKey: "Your API Key",
    apiSecret: "Your API Secret");
{% endhighlight %}

## 4. Advanced Configuration

### Request extra permissions

By default if no scope is specified, then `read_content` scope is used which gives read-only access to shop content (includes Shop's Article, Blog, Comment, Page and Redirect). If you want to request more permissions, you will need to add these to the `Scope` property:

{% highlight csharp %}
var options = new ShopifyAuthenticationOptions
{
    ApiKey = "Your API Key",
    ApiSecret = "Your API Secret"
};

// This grants write access to shop's content
options.Scope.Add("write_content");
// This grants write access to shop's Product, product variant, Product Image, Collect, Custom Collection and Smart Collection
options.Scope.Add("write_products");
app.UseShopifyAuthentication(options);
{% endhighlight %}

> For the full list of available scopes, see the [Shopify OAuth Scope documentation](https://docs.shopify.com/api/authentication/oauth#scopes).

### Specify an alternative callback path

By default the Shopify provider will request Shopify to redirect to the path `/signin-shopify` after the user has signed in and granted permissions on Shopify Shop. You can specify an alternative redirect URL:

{% highlight csharp %}
var options = new ShopifyAuthenticationOptions
{
    ApiKey = "Your API Key",
    ApiSecret = "Your API Secret",
    CallbackPath = new PathString("/oauth-redirect/shopify")
};
app.UseShopifyAuthentication(options);
{% endhighlight %}

### Retrieve access token and other shop information returned from Shopify

You can retrieve the shop information returned from Shopify in the `OnAuthenticated` callback function which gets invoked after the user has authenticated with Shopify shop:

{% highlight csharp %}
var options = new ShopifyAuthenticationOptions
{
    ApiKey = "Your API Key",
    ApiSecret = "Your API Secret",
    Provider = new ShopifyAuthenticationProvider
    {
        OnAuthenticated = async context =>
        {
            // Retrieve the OAuth access token to store for subsequent API calls
            string accessToken = context.AccessToken;

            // Retrieve Shopify shop Id.
            string shopId = context.Id;

            // Retrieve Shopify shop name
            string shopName = context.ShopName;

            // Retrieve the Shopify shop's primary email address
            string shopPrimaryEmailAddress = context.Email;

            // You can even retrieve the full JSON-serialized shop
            var serializedShopInformation = context.Shop;
        }
    }
};
app.UseShopifyAuthentication(options);
{% endhighlight %}

## 5. Imp: Shopify Shop's Name

### Passing Shop name to generate OAuth URL

The OAuth specific URLs in case of Shopify OAuth provider does not remain same. This are specific to shop against which the user wants to authorize.

**Example:** If user wants to authorize with Shop name **'mydemoshop'**, then OAuth URL(s) generated will be:

**Authorization URL:** `https://mydemoshop.myshopify.com/admin/oauth/authorize`
**Token URL:** `https://mydemoshop.myshopify.com/admin/oauth/authorize`

Shopify shop name is required to be passed against which the OAuth workflow for Shopify provider executes. This can be done by passing `ShopName` to `ChallengeResult` class that initiates and manages the OAuth workflow execution for a particular provider. Here is updated `ChallengeResult` code that contains provision to pass `ShopName`:

By default `ChallengeResult` class will be located in `\Controllers\AccountController.cs` class file.

{% highlight csharp %}
// Used for Shopify external login to provide shopname while building endpoints.
private const string ShopNameKey = "ShopName";

private class ChallengeResult : HttpUnauthorizedResult
{
    public ChallengeResult(string provider, string redirectUri)
        : this(provider, redirectUri, null, null)
    {
    }

    public ChallengeResult(string provider, string redirectUri, string userId, string shopName)
    {
        LoginProvider = provider;
        RedirectUri = redirectUri;
        UserId = userId;
        ShopName = shopName;
    }

    public string LoginProvider { get; set; }
    public string RedirectUri { get; set; }
    public string UserId { get; set; }
    public string ShopName { get; set; }

    public override void ExecuteResult(ControllerContext context)
    {
        var properties = new AuthenticationProperties() { RedirectUri = RedirectUri };
        if (UserId != null)
        {
            properties.Dictionary[XsrfKey] = this.UserId;
        }

        if (!string.IsNullOrWhiteSpace(this.ShopName))
        {
            properties.Dictionary[ShopNameKey] = this.ShopName;
        }

        context.HttpContext.GetOwinContext().Authentication.Challenge(properties, LoginProvider);
    }
}
{% endhighlight %}

Thus, Shopify OAuth provider workflow can be initiated from Controller - Action method as follows:

{% highlight csharp %}
// POST: /Account/ExternalLogin
[HttpPost]
[AllowAnonymous]
[ValidateAntiForgeryToken]
public ActionResult ExternalLogin(string provider, string returnUrl, string shopName = "")
{
    // Request a redirect to the external login provider
    return new ChallengeResult(provider, Url.Action("ExternalLoginCallback", "Account", new { ReturnUrl = returnUrl }), null, shopName);
}
{% endhighlight %}

**Note:** Passing shopname while using Shopify OAuth provider is required.